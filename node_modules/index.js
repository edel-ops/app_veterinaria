const http = require('http');
const url = require('url');

const callbackDelServidor = (req, res) => {

  // 1 obtener la url desde el objeto request (req)
  const urlActual = req.url;
  const urlParseada = url.parse(urlActual, true);
  //console.log({ urlActual, urlParseada });

  // 2 obtener la ruta
  const ruta = urlParseada.pathname;

  // 3 quitar slash / a las rutas
  const rutaLimpia = ruta.replace(/^\/+|\/+$/g, '');

  // 3.1 obtener el metodo http
  const metodo = req.method.toLowerCase();
  console.log('metodo http:', metodo);

  // 3.2 obtener variables del query url
  const {query = {}} = urlParseada;
  console.log('variables en el query:', {query});

  // 3.3 obtener los headers
  const {headers = {}} = req;
  console.log('headers:', headers);

  // 4 enviar la respuesta dependiendo de la ruta
  switch (rutaLimpia) {
    case 'ruta':
      res.end('Estas en una ruta conocida');
      break;
      
    default:
      res.end('Estas en una ruta desconocida');
  }
};

const server = http.createServer(callbackDelServidor);

server.listen(5000, () => {
  console.log('el servidor esta escuchando peticiones en http://localhost:5000/');
});